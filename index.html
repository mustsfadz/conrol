<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ›°ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù†Ø¸Ø§Ù… Ø§Ù„ØªØªØ¨Ø¹ - Ø®Ø±Ø§Ø¦Ø· Ù…Ø¨Ø§Ø´Ø±Ø©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #0f1a2b;
            color: #fff;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #00b4d8;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .sidebar {
            background: #1e2a3a;
            border-radius: 15px;
            padding: 20px;
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #00b4d8;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .stat-number {
            font-size: 1.8em;
            font-weight: bold;
            color: #00b4d8;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #bdc3c7;
        }
        
        .map-container {
            background: #1e2a3a;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            height: 600px;
        }
        
        #mainMap {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .tracking-list {
            background: #1e2a3a;
            border-radius: 15px;
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .tracking-card {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-right: 4px solid #e74c3c;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tracking-card:hover {
            transform: translateX(-5px);
            background: linear-gradient(135deg, #34495e, #2c3e50);
        }
        
        .tracking-card.active {
            border-right-color: #00b4d8;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: #00b4d8;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
            font-weight: bold;
        }
        
        .location-details {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .coordinates {
            color: #00b4d8;
            font-weight: bold;
            font-family: monospace;
        }
        
        .timestamp {
            color: #95a5a6;
            font-size: 0.9em;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            flex: 1;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .real-time-badge {
            background: #e74c3c;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .accuracy-badge {
            background: #f39c12;
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.7em;
            margin-right: 5px;
        }
        
        /* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        .tracking-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .tracking-list::-webkit-scrollbar-track {
            background: #2c3e50;
            border-radius: 4px;
        }
        
        .tracking-list::-webkit-scrollbar-thumb {
            background: #00b4d8;
            border-radius: 4px;
        }
        
        .tracking-list::-webkit-scrollbar-thumb:hover {
            background: #0096c7;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ›°ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù†Ø¸Ø§Ù… Ø§Ù„ØªØªØ¨Ø¹ - Ø®Ø±Ø§Ø¦Ø· Ù…Ø¨Ø§Ø´Ø±Ø©</h1>
        <p>Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±Ø§Ø¦Ø· ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ</p>
    </div>

    <div class="container">
        <div class="main-content">
            <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalVisits">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="withLocation">0</div>
                    <div class="stat-label">Ø²ÙˆØ§Ø± Ø¨Ø£Ù…Ø§ÙƒÙ† Ø¯Ù‚ÙŠÙ‚Ø©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="uniqueIPs">0</div>
                    <div class="stat-label">Ø¹Ù†ÙˆØ§ÙŠÙ† IP Ù…Ø®ØªÙ„ÙØ©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeNow">0</div>
                    <div class="stat-label">Ù†Ø´Ø· Ø§Ù„Ø¢Ù†</div>
                </div>
            </div>

            <!-- Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
            <div class="map-container">
                <iframe 
                    id="mainMap"
                    src="https://www.google.com/maps/embed/v1/view?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&zoom=10&center=24.7136,46.6753"
                    allowfullscreen>
                </iframe>
            </div>
        </div>

        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
        <div class="sidebar">
            <div class="controls">
                <button class="btn" onclick="loadTrackingData()">
                    ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <button class="btn btn-secondary" onclick="clearAllData()">
                    ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                </button>
            </div>

            <div class="tracking-list" id="trackingList">
                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
        </div>
    </div>

    <script>
        let currentSelectedUser = null;
        let allTrackingData = [];

        // ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØªØ¨Ø¹
        function loadTrackingData() {
            allTrackingData = JSON.parse(localStorage.getItem('trackingData') || '[]');
            const trackingList = document.getElementById('trackingList');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateStatistics();
            
            // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            displayUsersList();
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
            if (allTrackingData.length > 0 && !currentSelectedUser) {
                const lastUser = allTrackingData[allTrackingData.length - 1];
                if (lastUser.coordinates) {
                    showUserOnMap(lastUser);
                    highlightUserCard(lastUser.timestamp);
                }
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStatistics() {
            document.getElementById('totalVisits').textContent = allTrackingData.length;
            
            const withLocation = allTrackingData.filter(d => d.coordinates).length;
            document.getElementById('withLocation').textContent = withLocation;
            
            const uniqueIPs = new Set(allTrackingData.map(d => d.ip)).size;
            document.getElementById('uniqueIPs').textContent = uniqueIPs;
            
            // Ø§Ù„Ø²ÙˆØ§Ø± Ø§Ù„Ù†Ø´Ø·ÙˆÙ† (Ø¢Ø®Ø± 2 Ø¯Ù‚ÙŠÙ‚Ø©)
            const twoMinutesAgo = new Date(Date.now() - 2 * 60000).toISOString();
            const activeNow = allTrackingData.filter(d => d.timestamp > twoMinutesAgo).length;
            document.getElementById('activeNow').textContent = activeNow;
        }

        // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function displayUsersList() {
            const trackingList = document.getElementById('trackingList');
            
            if (allTrackingData.length === 0) {
                trackingList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #95a5a6;">
                        <div style="font-size: 3em; margin-bottom: 10px;">ğŸ›°ï¸</div>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</p>
                        <p style="font-size: 0.9em;">Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ²ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„ØµÙØ­Ø©ØŒ Ø³ØªØ¸Ù‡Ø± Ø¨ÙŠØ§Ù†Ø§ØªÙ‡Ù… Ù‡Ù†Ø§</p>
                    </div>
                `;
                return;
            }
            
            // Ø¹Ø±Ø¶ Ø¢Ø®Ø± 20 Ø²ÙŠØ§Ø±Ø© (Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…)
            const recentData = allTrackingData.slice(-20).reverse();
            
            trackingList.innerHTML = recentData.map((data, index) => {
                const isNew = isRecent(data.timestamp, 2); // Ø®Ù„Ø§Ù„ Ø¢Ø®Ø± Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ†
                const hasLocation = data.coordinates;
                const userNumber = allTrackingData.length - index;
                
                return `
                    <div class="tracking-card" data-timestamp="${data.timestamp}" onclick="showUserOnMap(this.dataset)">
                        <div class="user-info">
                            <div class="user-avatar">${userNumber}</div>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center;">
                                    ${isNew ? '<span class="real-time-badge">LIVE</span>' : ''}
                                    <strong>Ù…Ø³ØªØ®Ø¯Ù… #${userNumber}</strong>
                                </div>
                                <div class="timestamp">
                                    ${formatTimeAgo(data.timestamp)}
                                </div>
                            </div>
                            ${hasLocation ? 'ğŸ“' : 'âŒ'}
                        </div>
                        
                        ${hasLocation ? `
                        <div class="location-details">
                            <div><strong>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª:</strong></div>
                            <div class="coordinates">
                                ${data.coordinates.latitude.toFixed(6)}, ${data.coordinates.longitude.toFixed(6)}
                            </div>
                            <div style="margin-top: 5px;">
                                <span class="accuracy-badge">Ø¯Ù‚Ø©: ${Math.round(data.coordinates.accuracy)}m</span>
                                ${data.city ? `<span>ğŸ™ï¸ ${data.city}</span>` : ''}
                            </div>
                        </div>
                        ` : `
                        <div style="color: #95a5a6; font-size: 0.9em;">
                            âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¯Ù‚ÙŠÙ‚
                        </div>
                        `}
                        
                        <div style="margin-top: 10px; font-size: 0.8em; color: #bdc3c7;">
                            ğŸŒ ${data.ip || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} | ğŸ’» ${getBrowserName(data.userAgent)}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Ø¹Ø±Ø¶ Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        function showUserOnMap(userData) {
            if (!userData.coordinates) {
                alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                return;
            }

            const lat = userData.coordinates.latitude;
            const lng = userData.coordinates.longitude;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù…Ø¹ Ø¹Ù„Ø§Ù…Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹
            const mapUrl = `https://www.google.com/maps/embed/v1/view?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&zoom=16&center=${lat},${lng}&maptype=roadmap&markers=color:red%7C${lat},${lng}`;
            
            document.getElementById('mainMap').src = mapUrl;
            currentSelectedUser = userData;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            highlightUserCard(userData.timestamp);
        }

        // ØªÙ…ÙŠÙŠØ² Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯
        function highlightUserCard(timestamp) {
            document.querySelectorAll('.tracking-card').forEach(card => {
                card.classList.remove('active');
                if (card.dataset.timestamp === timestamp) {
                    card.classList.add('active');
                    card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
        }

        // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function clearAllData() {
            if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ØŸ')) {
                localStorage.removeItem('trackingData');
                loadTrackingData();
                document.getElementById('mainMap').src = 'https://www.google.com/maps/embed/v1/view?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&zoom=10&center=24.7136,46.6753';
            }
        }

        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        function isRecent(timestamp, minutes = 2) {
            const time = new Date(timestamp);
            const now = new Date();
            return (now - time) < (minutes * 60000);
        }

        function formatTimeAgo(timestamp) {
            const time = new Date(timestamp);
            const now = new Date();
            const diffMs = now - time;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            
            if (diffMins < 1) return 'Ø§Ù„Ø¢Ù†';
            if (diffMins < 60) return `Ù‚Ø¨Ù„ ${diffMins} Ø¯Ù‚ÙŠÙ‚Ø©`;
            if (diffHours < 24) return `Ù‚Ø¨Ù„ ${diffHours} Ø³Ø§Ø¹Ø©`;
            return time.toLocaleString('ar-SA');
        }

        function getBrowserName(userAgent) {
            if (!userAgent) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            if (userAgent.includes("Chrome")) return "Chrome";
            if (userAgent.includes("Firefox")) return "Firefox";
            if (userAgent.includes("Safari")) return "Safari";
            if (userAgent.includes("Edge")) return "Edge";
            return "Ù…ØªØµÙØ­";
        }

        // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 3 Ø«ÙˆØ§Ù†ÙŠ
        setInterval(loadTrackingData, 3000);
        
        // Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
        window.addEventListener('load', function() {
            loadTrackingData();
            console.log('ğŸ—ºï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù…Ø¹ Ø§Ù„Ø®Ø±Ø§Ø¦Ø· Ø¬Ø§Ù‡Ø²Ø© - Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©...');
            
            // Ø¨Ø¯Ø¡ ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
            setInterval(() => {
                const activeBadges = document.querySelectorAll('.real-time-badge');
                activeBadges.forEach(badge => {
                    badge.style.animation = 'none';
                    setTimeout(() => badge.style.animation = 'pulse 2s infinite', 10);
                });
            }, 2000);
        });
    </script>
</body>
</html>